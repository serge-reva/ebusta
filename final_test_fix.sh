#!/bin/bash
set -e

echo "üõ† 1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ —Ç–µ—Å—Ç–∞—Ö (q -> query)..."
# –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ smoke_full.sh –¥–ª—è –ø—Ä—è–º—ã—Ö –≤—ã–∑–æ–≤–æ–≤ curl
if [ -f tests/smoke_full.sh ]; then
    sed -i 's/"q":/"query":/g' tests/smoke_full.sh
    # –¢–∞–∫–∂–µ —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ —Ç–∞–º cloud-1 (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
    sed -i 's/192.168.1.179/cloud-1/g' tests/smoke_full.sh
fi

echo "üöÄ 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã –¥–ª—è —á–∏—Å—Ç–æ—Ç—ã —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞..."
make stop
make run

echo "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ (5 —Å–µ–∫)..."
sleep 5

echo "üß™ 3. –§–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥–æ–Ω smoke..."
make smoke

echo "üèÅ –í—Å–µ —Ç–µ—Å—Ç—ã (–∫—Ä–æ–º–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞) –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏."
