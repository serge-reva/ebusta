# Specification: Ebusta Search DSL (v1.1)

## 1. Goal
Предоставление человекочитаемого языка запросов для поиска книг, который транслируется в структурированное дерево (AST) для поискового движка Mercury.

## 2. Lexical Atoms (Лексика)
- **Action**: `get`, `find`, `list`, `read` (зарезервированы)
- **Field Prefixes**: `title:`, `author:`, `author_id:`, `desc:`
- **Logic Operators**: `AND`, `OR` (регистронезависимые)
- **Unary Operators**: `NOT`
- **Pattern**: `/regex/` (строка, обернутая в косую черту)
- **Literal**: `"exact phrase"`, `simple_word`, `101`

## 3. Функциональные требования

### UR 1: Базовый поиск
- **UR 1.1 (Default Search)**: Любой ввод без префикса (например, `Unix`) должен интерпретироваться как поиск по всем полям (`field: any`).
- **UR 1.2 (Case Insensitivity)**: Поиск по умолчанию нечувствителен к регистру.

### UR 2: Целевой поиск (Scoping)
- **UR 2.1 (Field Limiting)**: Использование префикса `field:` ограничивает поиск конкретным мета-полем.
- **UR 2.2 (Regex)**: Если значение обернуто в `/ /`, система должна использовать регулярные выражения (Operator: `OP_REGEX`).

### UR 3: Сложная логика (Boolean)
- **UR 3.1 (Combination)**: Поддержка операторов `AND` и `OR` для объединения условий.
- **UR 3.2 (Negation)**: Поддержка оператора `NOT` для исключения результатов из выдачи.
- **UR 3.3 (Precedence)**: Приоритет операторов: `NOT` > `AND` > `OR`.

### UR 4: Обратная связь (Feedback)
- **UR 4.1 (Explanation)**: Каждый ответ системы должен содержать поле `meta.canonical_form`, отображающее дерево разбора запроса для верификации пользователем.
- **UR 4.2 (Request Tracing)**: Каждому запросу присваивается `request_id`, который пробрасывается через всю цепочку (Adapter -> Converter -> Processor -> Mercury).

## 4. Примеры валидных запросов
- `author:Кинг AND NOT title:Куджо`
- `title:/^Unix.*/ OR desc:linux`
- `101` (трактуется как поиск ID или любой поиск по "101")
