#!/bin/bash

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–∫–∞–∫ –≤ —Ç–≤–æ–µ–º –∫–æ–Ω—Ñ–∏–≥–µ)
OS_HOST="http://cloud-1:9200"

# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ–∂–∏–¥–∞–µ–º—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤
TEMPLATES=(
    "fl_mixed_search"       # –î–µ—Ñ–æ–ª—Ç–Ω—ã–π
    "fl_author_exact"       # –ê–≤—Ç–æ—Ä (—Ç–æ—á–Ω–æ)
    "fl_author_fuzzy"       # –ê–≤—Ç–æ—Ä (–Ω–µ—á–µ—Ç–∫–æ)
    "fl_title_match"        # –ù–∞–∑–≤–∞–Ω–∏–µ (—Ç–æ—á–Ω–æ)
    "fl_title_substring"    # –ù–∞–∑–≤–∞–Ω–∏–µ (–ø–æ–¥—Å—Ç—Ä–æ–∫–∞)
    "fl_titles_all"         # –ê–≥—Ä–µ–≥–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π
    "fl_authors_all"        # –ê–≥—Ä–µ–≥–∞—Ü–∏—è –∞–≤—Ç–æ—Ä–æ–≤
    "fl_title_prefix"       # –ü—Ä–µ—Ñ–∏–∫—Å –Ω–∞–∑–≤–∞–Ω–∏—è
    "fl_names_token_prefix" # –ü—Ä–µ—Ñ–∏–∫—Å –∏–º–µ–Ω
    "fl_id_lookup"          # [NEW] –ü–æ–∏—Å–∫ –ø–æ ID
    "fl_desc_match"         # [NEW] –ü–æ–∏—Å–∫ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é
    "fl_container_lookup"   # [NEW] –ü–æ–∏—Å–∫ –ø–æ –∞—Ä—Ö–∏–≤—É
    "fl_filename_lookup"    # [NEW] –ü–æ–∏—Å–∫ –ø–æ —Ñ–∞–π–ª—É
    "fl_author_id"          # [NEW] –ê–≤—Ç–æ—Ä –∫–∞–∫ ID
)

echo "=== –ü—Ä–æ–≤–µ—Ä–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤ OpenSearch ($OS_HOST) ==="
echo "------------------------------------------------"
printf "%-25s | %-10s\n" "TEMPLATE ID" "STATUS"
echo "------------------------------------------------"

ALL_OK=true

for tpl in "${TEMPLATES[@]}"; do
    # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–æ–¥ –æ—Ç–≤–µ—Ç–∞ (200 = OK, 404 = Missing)
    HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" "$OS_HOST/_scripts/$tpl")

    if [ "$HTTP_CODE" == "200" ]; then
        printf "%-25s | \033[0;32m‚úÖ INSTALLED\033[0m\n" "$tpl"
    else
        printf "%-25s | \033[0;31m‚ùå MISSING ($HTTP_CODE)\033[0m\n" "$tpl"
        ALL_OK=false
    fi
done

echo "------------------------------------------------"
if [ "$ALL_OK" = true ]; then
    echo "üéâ –í—Å–µ —à–∞–±–ª–æ–Ω—ã –Ω–∞ –º–µ—Å—Ç–µ. –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞."
else
    echo "‚ö†Ô∏è  –í–Ω–∏–º–∞–Ω–∏–µ: –ù–∞–π–¥–µ–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —à–∞–±–ª–æ–Ω—ã."
    echo "    –ó–∞–ø—É—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—ã curl –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —à–∞–≥–∞ –¥–ª—è –∏—Ö –∑–∞–≥—Ä—É–∑–∫–∏."
fi
